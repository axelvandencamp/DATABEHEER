---------------------------------------------------
--info partners en mandated obv lijst id's
---------------------------------------------------
--/*
SELECT	DISTINCT--COUNT(p.id) _aantal, now()::date vandaag
	p.id database_id, 
	p.name,
	p.membership_start Lidmaatschap_startdatum, 
	p.membership_stop Lidmaatschap_einddatum, 
	p.membership_end Recentste_einddatum_lidmaatschap, 
	p.membership_pay_date Betaaldatum, 
	p.membership_cancel opzegdatum, --opzegdatum
	p.active,
	--sm.id,
	p.membership_state,
	sm.state,
	sm.unique_mandate_reference,
	pb.bank_bic, acc_number,
----------------------------------------------------------
	p.first_name || ' ' || p.last_name as NAW1,
	CASE
		WHEN c.id = 21 AND p.crab_used = 'true' THEN ccs.name
		ELSE p.street
	END || ' ' ||
	CASE
		WHEN c.id = 21 AND p.crab_used = 'true' THEN p.street_nbr ELSE ''
	END || 
	CASE
		WHEN COALESCE(p.street_bus,'_') = '_' OR p.street_bus = ''  THEN '' ELSE ' bus ' || p.street_bus 
	END NAW2,
	CASE
		WHEN c.id = 21 AND p.crab_used = 'true' THEN cc.zip
		ELSE p.zip
	END || ' ' || 
	CASE 
		WHEN c.id = 21 AND p.crab_used = 'true' THEN cc.name ELSE p.city 
	END NAW3,
	--p.postbus_nbr postbus,
	CASE
		WHEN p.country_id = 21 AND substring(p.zip from '[0-9]+')::numeric BETWEEN 1000 AND 1299 THEN 'Brussel' 
		WHEN p.country_id = 21 AND (substring(p.zip from '[0-9]+')::numeric BETWEEN 1500 AND 1999 OR substring(p.zip from '[0-9]+')::numeric BETWEEN 3000 AND 3499) THEN 'Vlaams Brabant'
		WHEN p.country_id = 21 AND substring(p.zip from '[0-9]+')::numeric BETWEEN 2000 AND 2999  THEN 'Antwerpen' 
		WHEN p.country_id = 21 AND substring(p.zip from '[0-9]+')::numeric BETWEEN 3500 AND 3999  THEN 'Limburg' 
		WHEN p.country_id = 21 AND substring(p.zip from '[0-9]+')::numeric BETWEEN 8000 AND 8999  THEN 'West-Vlaanderen' 
		WHEN p.country_id = 21 AND substring(p.zip from '[0-9]+')::numeric BETWEEN 9000 AND 9999  THEN 'Oost-Vlaanderen' 
		WHEN p.country_id = 21 THEN 'WalloniÃ«'
		WHEN p.country_id = 166 THEN 'Nederland'
		WHEN NOT(p.country_id IN (21,166)) THEN 'Buitenland niet NL'
		ELSE 'andere'
	END AS provincie,
	c.name land,
	COALESCE(p.email,p.email_work) email
--*/
FROM 	res_partner p
	LEFT OUTER JOIN res_partner_bank pb ON pb.partner_id = p.id
	LEFT OUTER JOIN sdd_mandate sm ON sm.partner_bank_id = pb.id
	--land, straat, gemeente info
	JOIN res_country c ON p.country_id = c.id
	LEFT OUTER JOIN res_country_city_street ccs ON p.street_id = ccs.id
	LEFT OUTER JOIN res_country_city cc ON p.zip_id = cc.id
	--facturen info
	--LEFT OUTER JOIN account_invoice_line il ON il.id = ml.account_invoice_line
	--LEFT OUTER JOIN account_invoice i ON i.id = il.invoice_id
WHERE 	p.id IN ('18888','19539','20238','20403','22316','22316','23185','23199','23243','23437','23851','23851','27690','27981','29824','31258','31588','35433','35556','38251','40052','40269','43345','45387','45606','46763','54438','54953','57917','58800','58817','59108','62273','62565','62710','62710','65034','65275','67659','73453','75953','75953','76389','77159','80598','80896','80896','84693','85162','85363','86418','87670','88908','89470','89470','90093','91604','95553','97481','98488','99981','101327','101802','101802','103788','104324','105049','106205','106697','107429','107671','107775','108037','108050','108380','108536','108662','108991','109374','109747','110230','110299','110307','110397','111229','111855','111931','112510','113233','113233','114186','114870','115082','116141','116416','116520','116609','117159','117207','117461','117564','117910','118801','119616','119624','120282','120905','121017','121017','122512','123453','123453','123544','124484','124742','124760','124896','125909','126256','126493','126718','126745','127030','127954','128126','129396','131633','131810','132461','132619','132645','132955','133567','133567','133567','133910','136835','136919','137392','138249','138282','138444','138484','138558','138687','138690','139415','139437','140108','140685','141403','141403','141617','142231','142343','142816','142875','143049','143076','143626','144284','144568','146072','146185','146803','146955','147031','147796','147854','148255','148422','148700','149927','149966','150094','150317','150920','151290','152452','152476','152835','152891','153071','153385','153809','153809','154015','154687','154872','154872','155222','155820','156056','156128','156207','156302','156613','156782','156786','156907','156944','157375','157375','158325','158536','158983','160650','160697','162031','162031','162393','162393','162498','162682','162779','162893','162897','163044','164173','164332','164811','164942','165879','166332','166393','166846','167037','168089','168197','168238','168238','168331','168703','169157','169169','170026','170116','170264','171385','172569','173254','173625','173662','174169','174172','175032','175143','176316','177254','177392','177888','178735','178774','179080','179256','179883','180105','180853','181427','181744','181840','181865','182068','182120','183411','183411','184074','184190','184956','185873','186285','186492','186662','186780','189234','189927','190264','190277','190783','190906','190962','191820','191902','191958','192201','192751','192877','193349','193611','193767','194371','194551','195567','195819','196227','196866','197702','197905','198763','198861','198923','199013','199013','199599','200324','200357','200760','200871','200931','201907','201975','202018','202248','202289','202377','203190','203247','203380','203550','203763','203972','204204','204224','204494','205169','205515','205686','205842','206339','206339','206453','206811','207320','207820','207926','208164','208574','209397','209605','209955','210114','210337','210443','210523','211225','211295','211464','211713','211842','211991','212465','212785','212961','213684','214327','214409','214784','214825','215485','215620','215675','215893','216108','216819','217337','217410','218016','218154','218434','218888','219276','219492','219570','219761','220026','220213','220223','220240','221016','221411','221411','221575','221876','221926','222076','222125','222145','222375','222568','222783','222784','222818','222851','223863','224720','225062','225354','225635','225646','225691','225875','227017','227204','227658','227828','227975','228171','228213','228265','228666','228899','229133','229758','229920','230047','230622','231018','231317','232954','233237','233327','233671','234055','234588','234920','235728','236453','237314','237349','237504','237956','238226','238241','238484','239035','239204','239277','239295','239318','239491','240013','240023','240330','241123','241128','241196','241202','241362','241369','241407','241560','242180','242427','242560','242681','242733','243030','243329','243764','244001','244140','244345','244547','244569','245135','245434','245503','245818','246021','246484','246654','246746','250326','250326','250620','250620','250620','251019','251170','251554','251645','251729','252033','252133','252211','252293','253178','253301','254414','254653','259424','259424','259669','262677','263126','263368','263372','263385','263394','263401','263993','264316','264341','264503','264503','264706','264874','264906','265062','266116','266281','266304','266436','267072','267086')	
ORDER 	BY p.id

-----------------
-- bank details
SELECT pb.bank_bic, acc_number, sm.unique_mandate_reference, pb.partner_id
FROM res_partner_bank pb 
	LEFT OUTER JOIN sdd_mandate sm ON sm.partner_bank_id = pb.id
WHERE sm.unique_mandate_reference IN ('RUM0021839')
